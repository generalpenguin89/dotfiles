# .zshrc
#
# Patrick MacArthur
#
# vim: set filetype=zsh :

# Lines configured by zsh-newuser-install
HISTFILE=~/.histfile
HISTSIZE=5000
SAVEHIST=5000
bindkey -v
# End of lines configured by zsh-newuser-install
# The following lines were added by compinstall
zstyle :compinstall filename '/home/patrick/.zshrc'

autoload -Uz compinit
compinit
# End of lines added by compinstall

# The following is partially based on my prior .bashrc and partially based on
# an example .zshrc provided at http://people.freedesktop.org/~whot/zsh-setup
setopt appendhistory  #append to history
setopt inc_append_history # append immediately
setopt hist_expire_dups_first # expire duplicates in history first
setopt hist_ignore_all_dups # dont add dupes to history

autoload -Uz vcs_info
zstyle ':vcs_info:*' disable bzr cdv cvs darcs mtn p4 svk tla

# Commands to run before the command prompt (PS1) is displayed.
# We use this to display the current SVN branch if necessary and update
# the window title.
function precmd {
    # Gets and echoes the current svn branch that we are under
    vcs_info

    # Set SVN branch
    SVNBRANCH="$vcs_info_msg_0_"

    # Set xterm/screen title
    case $TERM in
        xterm*|screen*) print -Pn "\e]0;[%!] %n@%m:%~\a" ;;
    esac
}

# Sets the prompt.  Not necessary to segregate into a function but helps
# to organize things a bit.
setprompt() {
    setopt prompt_subst

    # See if we can use colors. (source: http://aperiodic.net/phil/prompt/)
    autoload colors zsh/terminfo
    if [[ "$terminfo[colors]" -ge 8 ]]; then
        colors
    fi
    for color in RED GREEN YELLOW BLUE MAGENTA CYAN WHITE; do
        eval PR_$color='%{$terminfo[bold]$fg[${(L)color}]%}'
        eval PR_LIGHT_$color='%{$fg[${(L)color}]%}'
        (( count = $count + 1 ))
    done
    PR_NO_COLOR="%{$terminfo[sgr0]%}"

    happy="$PR_BLUE:-)$PR_CYAN"
    sad="$PR_RED:-($PR_CYAN"

    export PS1="$bgcolor%(!.$PR_RED.$PR_CYAN)[%!] %n@%m:%~$PR_YELLOW\
\$SVNBRANCH$PR_CYAN %(?.$happy.$sad) %#$PR_NO_COLOR "
}

setprompt

# colorize grep and stuff
if whence -p colordiff >/dev/null 2>&1; then
    alias diff='colordiff'
    function svndiff {
        svn diff --no-diff-deleted $@ | colordiff | less -R;
    }
else
    function svndiff {
        svn diff --no-diff-deleted $@ | less -R;
    }
fi

alias grep='grep --color=auto'

function svnlog { svn log $@ | less -R; }
function svnhelp { svn help $@ | less -R; }

# Add home bin to path
export PATH="$HOME/bin:$PATH"

# Make stuff
alias mk3="make -j3"

if [[ $(uname -s) == "Linux" ]]; then
    alias ls='ls --color=auto'
elif [[ $(uname -s) == "FreeBSD" ]]; then
    alias ls='ls -G'
fi
alias l="ls -lF"
alias ll="ls -l"

alias head='head -n $(($LINES-5))'
alias tail='tail -n $(($LINES-5))'

export VISUAL=vim
export EDITOR=$VISUAL
export LESS="-QR"

source $HOME/.zshrc.local

# cd without typing 'cd'
setopt autocd
